# Кодирование и декодирование

## Описание проекта

Этот проект представляет собой сервис для сокращения URL, предоставляющий функциональные возможности, такие как создание
сокращённых ссылок, редирект, срок жизни ссылок, а также отправка данных об URL на указанный эндпоинт.
`Для запуска запустите скрипт start.sh`

## Функциональные возможности

### 1. POST-ендпоинт для генерации хеша (1 балл)

- **Метод**: `POST /tohash`
  ```json
  {
      "url": "vk.com"
  }
- **Описание**: Принимает URL и возвращает JSON с 5-значным хешем и самим URL.
- **Ответ**:
  ```json
  {
      "hash": "maxim"
  }
- **Описание процесса**: Ссылка сохраняется в базе данных.

### 2. GET-ендпоинт для декодирования хеша (1 балл)

- **Метод**: `GET /geturl/maxim`
- **Описание**: Принимает хеш, декодирует его и возвращает JSON с оригинальной ссылкой.
- **Ответ**:
  ```json
  {
      "url": "https://vk.com"
  }

### 3. GET-ендпоинт для редиректа (1 балл)

- **Метод**: `GET /redirecturl/maxim`
- **Описание**: Принимает хеш и редиректит пользователя на декодированный URL.

### 4. Поиск существующего URL (2 балла)

- **Метод**: `POST /searchurl`
  ```json
    {
        "url": "https://vk.com"
    }
- **Описание**: При кодировании URL происходит поиск такого же URL в базе данных.
  Если найден, используется его хеш, чтобы избежать дублирования. Если не найден, то создать его
- **Выполнение**: На основе переданного URL - ищем запись в БД, если есть - возвращаем hash-значение,
  иначе создаем и возвращаем
- **Ответ**:
  ```json
  {
      "url": "maxim"
  }

### 5. Срок жизни ссылок (3 балла)

- **Описание**: Добавляется срок жизни для закодированного URL.
  После истечения недели ссылка больше не декодируется, и возвращается ошибка.
- **Выполнение**: Создан метод в модели, который сравнивает поле created_at с настоящим временем.

### 6. Команда для отправки данных на внешний эндпоинт (4 балла)

- **Описание**: Добавляется команда, которая отправляет информацию об URL и дате его создания на указанный в конфиге
  эндпоинт. Команда отправляет только новые данные.
- **Выполнение**: Добавляем поле (статус) в таблице ссылок, которое говорит нам о том, была отправлена ссылка ранее или
  нет.
  Создаем конфиг файл, в котором будем хранить эндпоинт, на который будут отправлены ссылки, также изменяем статус
  записи в БД
  после первичной отправки.

## Дополнительные задания

## 1. Тесты (1 балл)

### Описание тестов для LinkController

Для запуска тестов введите команду `docker-compose run --rm artisan test tests/Feature/LinkControllerTest.php`

Этот файл содержит функциональные тесты для эндпоинтов контроллера **LinkController**, который управляет созданием и
декодированием сокращённых ссылок, а также редиректами и поиском по URL. Тесты проверяют работу системы с хешами URL и
поведением при истечении срока жизни ссылок.

### 1. Тест `testCodeToHash()`

Этот тест проверяет работу POST-ендпоинта `/tohash`, который отвечает за создание 5-значного хеша для переданного URL:

- **Сценарий 1**: Если записи с таким URL в базе нет, создаётся новая запись и сохраняется в базу данных. Проверка
  осуществляется через метод `assertDatabaseHas()`.
- **Сценарий 2**: Если запись с таким URL уже существует и не истекла, возвращается её хеш без повторного создания.
- **Сценарий 3**: Если запись с таким URL существует, но её срок жизни истёк, возвращается ошибка. Ожидается
  статус `500`.

### 2. Тест `testGetUrlFromHash()`

Этот тест проверяет работу GET-ендпоинта `/geturl/{hash}`, который декодирует хеш и возвращает исходный URL:

- **Сценарий 1**: Если запись существует и её срок жизни не истек, возвращается URL с кодом статуса `200`.
- **Сценарий 2**: Если записи с указанным хешем нет, возвращается ошибка `404`.
- **Сценарий 3**: Если срок жизни записи истек, также возвращается ошибка `404`.

### 3. Тест `testSearchUrl()`

Этот тест проверяет работу GET-ендпоинта `/searchurl/{url}`, который ищет запись по URL:

- **Сценарий 1**: Если запись существует, возвращается её хеш с кодом статуса `200`.
- **Сценарий 2**: Если записи нет, создаётся новая и возвращается её хеш с кодом статуса `200`.

### 4. Тест `testRedirectUrl()`

Этот тест проверяет работу GET-ендпоинта `/redirecturl/{hash}`, который редиректит пользователя на исходный URL по хешу:

- **Сценарий 1**: Если запись существует и её срок жизни не истек, происходит редирект на исходный URL.
- **Сценарий 2**: Если записи нет или срок жизни истек, возвращается ошибка с кодом `404`.

### Итог

Эти тесты покрывают основные функции сервиса сокращения URL, включая генерацию хешей, декодирование, редиректы и работу
с истечением срока жизни ссылок. Тестирование выполняется с различными сценариями, что помогает проверить корректность
работы системы при разных входных данных.

## 2. Обработка ошибок (1 балл)

Для обработки ошибок было создано исключение **LinkIsExpired**, которое говорит о том, что срок жизни ссылки истек и она
не является действительной в этом приложении.



